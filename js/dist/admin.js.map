{"version":3,"file":"admin.js","sources":["../src/admin/components/DynamicSlideSettingsComponent.tsx","../src/common/config/defaults.ts","../src/admin/index.tsx"],"sourcesContent":["import app from 'flarum/admin/app';\r\nimport Component from 'flarum/common/Component';\r\nimport Button from 'flarum/common/components/Button';\r\nimport m from 'mithril';\r\n\r\ninterface SlideData {\r\n  id: number;\r\n  link: string;\r\n  image: string;\r\n}\r\n\r\ninterface DynamicSlideSettingsComponentAttrs {\r\n  extensionId: string;\r\n  maxSlides?: number;\r\n}\r\n\r\n/**\r\n * Dynamic component for managing advertisement slide settings with add/delete functionality\r\n */\r\nexport default class DynamicSlideSettingsComponent extends Component<DynamicSlideSettingsComponentAttrs> {\r\n  private slides: SlideData[] = [];\r\n  private loading = false;\r\n  private nextId = 1;\r\n\r\n  oninit(vnode: any) {\r\n    super.oninit(vnode);\r\n    this.loadExistingSlides();\r\n  }\r\n\r\n  /**\r\n   * Load existing slides from settings\r\n   */\r\n  private loadExistingSlides() {\r\n    const { extensionId, maxSlides = 30 } = this.attrs;\r\n    const slides: SlideData[] = [];\r\n    \r\n    // Load existing slides from settings\r\n    for (let i = 1; i <= maxSlides; i++) {\r\n      const linkKey = `${extensionId}.Link${i}`;\r\n      const imageKey = `${extensionId}.Image${i}`;\r\n      const link = app.data.settings[linkKey] || '';\r\n      const image = app.data.settings[imageKey] || '';\r\n      \r\n      // Only include slides that have at least one field filled\r\n      if (link || image) {\r\n        slides.push({\r\n          id: i,\r\n          link,\r\n          image\r\n        });\r\n        this.nextId = Math.max(this.nextId, i + 1);\r\n      }\r\n    }\r\n    \r\n    this.slides = slides;\r\n    \r\n    // If no slides exist, add one empty slide to start with\r\n    if (slides.length === 0) {\r\n      this.addSlide();\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Add a new slide\r\n   */\r\n  private addSlide() {\r\n    const newSlide: SlideData = {\r\n      id: this.nextId++,\r\n      link: '',\r\n      image: ''\r\n    };\r\n    \r\n    this.slides.push(newSlide);\r\n    m.redraw();\r\n  }\r\n\r\n  /**\r\n   * Remove a slide\r\n   */\r\n  private removeSlide(slideId: number) {\r\n    const { extensionId } = this.attrs;\r\n    const slideIndex = this.slides.findIndex(slide => slide.id === slideId);\r\n    \r\n    if (slideIndex === -1) return;\r\n    \r\n    const slide = this.slides[slideIndex];\r\n    \r\n    // Remove from backend\r\n    this.saveSetting(`${extensionId}.Link${slide.id}`, '');\r\n    this.saveSetting(`${extensionId}.Image${slide.id}`, '');\r\n    \r\n    // Remove from local state\r\n    this.slides.splice(slideIndex, 1);\r\n    \r\n    // Ensure at least one slide exists\r\n    if (this.slides.length === 0) {\r\n      this.addSlide();\r\n    }\r\n    \r\n    m.redraw();\r\n  }\r\n\r\n  /**\r\n   * Update slide data\r\n   */\r\n  private updateSlide(slideId: number, field: 'link' | 'image', value: string) {\r\n    const { extensionId } = this.attrs;\r\n    const slide = this.slides.find(s => s.id === slideId);\r\n    \r\n    if (!slide) return;\r\n    \r\n    slide[field] = value;\r\n    \r\n    // Save to backend\r\n    const settingKey = field === 'link' \r\n      ? `${extensionId}.Link${slide.id}` \r\n      : `${extensionId}.Image${slide.id}`;\r\n    \r\n    this.saveSetting(settingKey, value);\r\n  }\r\n\r\n  /**\r\n   * Save setting to backend with debouncing\r\n   */\r\n  private saveSetting(key: string, value: string) {\r\n    // Clear existing timeout for this key\r\n    const timeoutKey = `saveTimeout_${key}`;\r\n    clearTimeout((this as any)[timeoutKey]);\r\n    \r\n    // Set new timeout\r\n    (this as any)[timeoutKey] = setTimeout(() => {\r\n      app.data.settings[key] = value;\r\n      \r\n      app.request({\r\n        method: 'POST',\r\n        url: app.forum.attribute('apiUrl') + '/settings',\r\n        body: {\r\n          [key]: value\r\n        }\r\n      }).catch(() => {\r\n        // Handle save error silently for now\r\n      });\r\n    }, 500);\r\n  }\r\n\r\n  view() {\r\n    return m('div.Form-group', [\r\n      m('label.FormLabel', \r\n        app.translator.trans('wusong8899-client1.admin.SlideSettings')\r\n      ),\r\n      m('div.helpText', \r\n        app.translator.trans('wusong8899-client1.admin.SlideSettingsHelp')\r\n      ),\r\n\r\n      m('div.DynamicSlideSettings', [\r\n        // Slides list\r\n        this.slides.map((slide, index) => this.renderSlide(slide, index)),\r\n        \r\n        // Add button\r\n        m('div.DynamicSlideSettings-addButton', [\r\n          m(Button, {\r\n            className: 'Button Button--primary',\r\n            icon: 'fas fa-plus',\r\n            onclick: () => this.addSlide()\r\n          }, app.translator.trans('wusong8899-client1.admin.AddSlide'))\r\n        ])\r\n      ])\r\n    ]);\r\n  }\r\n\r\n  /**\r\n   * Render a single slide\r\n   */\r\n  private renderSlide(slide: SlideData, index: number) {\r\n    return m('div.DynamicSlideSettings-slide', {\r\n      key: slide.id\r\n    }, [\r\n      m('div.DynamicSlideSettings-slideHeader', [\r\n        m('h4', app.translator.trans('wusong8899-client1.admin.SlideNumber', { number: index + 1 })),\r\n        m(Button, {\r\n          className: 'Button Button--danger',\r\n          icon: 'fas fa-trash',\r\n          onclick: () => this.removeSlide(slide.id),\r\n          disabled: this.slides.length === 1\r\n        }, app.translator.trans('wusong8899-client1.admin.DeleteSlide'))\r\n      ]),\r\n      \r\n      m('div.DynamicSlideSettings-slideFields', [\r\n        // Link URL field\r\n        m('div.Form-group', [\r\n          m('label.FormLabel', \r\n            app.translator.trans('wusong8899-client1.admin.SlideLink')\r\n          ),\r\n          m('input.FormControl', {\r\n            type: 'url',\r\n            placeholder: 'https://example.com',\r\n            value: slide.link,\r\n            oninput: (e: Event) => {\r\n              const target = e.target as HTMLInputElement;\r\n              this.updateSlide(slide.id, 'link', target.value);\r\n            }\r\n          })\r\n        ]),\r\n        \r\n        // Image URL field\r\n        m('div.Form-group', [\r\n          m('label.FormLabel', \r\n            app.translator.trans('wusong8899-client1.admin.SlideImage')\r\n          ),\r\n          m('input.FormControl', {\r\n            type: 'url',\r\n            placeholder: 'https://example.com/image.jpg',\r\n            value: slide.image,\r\n            oninput: (e: Event) => {\r\n              const target = e.target as HTMLInputElement;\r\n              this.updateSlide(slide.id, 'image', target.value);\r\n            }\r\n          })\r\n        ])\r\n      ])\r\n    ]);\r\n  }\r\n}\r\n","import type { RootConfig } from './types';\r\n\r\nexport const defaultConfig: RootConfig = {\r\n  env: (process.env.NODE_ENV as any) || 'production',\r\n  app: {\r\n    extensionId: 'wusong8899-client1-header-adv',\r\n    translationPrefix: 'wusong8899-client1',\r\n  },\r\n  slider: {\r\n    maxSlides: 30,\r\n    defaultTransitionTime: 5000,\r\n    checkTime: 10,\r\n    dataCheckInterval: 100,\r\n    dom: {\r\n      containerId: 'swiperAdContainer',\r\n      swiperClass: 'adSwiper',\r\n    },\r\n    swiper: {\r\n      spaceBetween: 30,\r\n      effect: 'coverflow',\r\n      centeredSlides: true,\r\n      slidesPerView: 2,\r\n      coverflowEffect: {\r\n        rotate: 0,\r\n        depth: 100,\r\n        modifier: 1,\r\n        slideShadows: true,\r\n        stretch: 0,\r\n      },\r\n      pagination: {\r\n        el: '.swiper-pagination',\r\n        type: 'bullets',\r\n      },\r\n      navigation: {\r\n        nextEl: '.swiper-button-next',\r\n        prevEl: '.swiper-button-prev',\r\n      },\r\n    },\r\n  },\r\n  ui: {\r\n    headerIconId: 'wusong8899Client1HeaderIcon',\r\n    headerIconUrl: 'https://ex.cc/assets/files/date/test.png',\r\n  },\r\n  data: {\r\n    apiResources: {\r\n      // Links queue functionality moved to client1-links-queue extension\r\n    },\r\n  },\r\n};\r\n\r\n","import app from 'flarum/admin/app';\r\nimport DynamicSlideSettingsComponent from './components/DynamicSlideSettingsComponent';\r\nimport { defaultConfig } from '../common/config';\r\n\r\n/**\r\n * Social media platforms configuration\r\n */\r\nconst SOCIAL_PLATFORMS = ['Kick', 'Facebook', 'Twitter', 'YouTube', 'Instagram'] as const;\r\n\r\n/**\r\n * Get max slides value from settings or use default\r\n */\r\nfunction getMaxSlides(extensionId: string): number {\r\n  const backendMaxSlides = app.data.settings[`${extensionId}.MaxSlides`];\r\n  return backendMaxSlides ? parseInt(backendMaxSlides) : defaultConfig.slider.maxSlides;\r\n}\r\n\r\n/**\r\n * Initialize the client1-header-adv admin extension\r\n */\r\napp.initializers.add('wusong8899-client1-header-adv', (): void => {\r\n  const extensionId = defaultConfig.app.extensionId;\r\n  const extensionData = app.extensionData.for(extensionId);\r\n\r\n  // Core settings\r\n  extensionData.registerSetting({\r\n    setting: `${extensionId}.TransitionTime`,\r\n    type: 'number',\r\n    label: app.translator.trans('wusong8899-client1.admin.TransitionTime'),\r\n  });\r\n\r\n  extensionData.registerSetting({\r\n    setting: `${extensionId}.HeaderIconUrl`,\r\n    type: 'url',\r\n    label: app.translator.trans('wusong8899-client1.admin.HeaderIconUrl'),\r\n    help: app.translator.trans('wusong8899-client1.admin.HeaderIconUrlHelp'),\r\n  });\r\n\r\n  extensionData.registerSetting({\r\n    setting: `${extensionId}.MaxSlides`,\r\n    type: 'number',\r\n    label: app.translator.trans('wusong8899-client1.admin.MaxSlides'),\r\n    help: app.translator.trans('wusong8899-client1.admin.MaxSlidesHelp'),\r\n  });\r\n\r\n  // Social media settings\r\n  SOCIAL_PLATFORMS.forEach((platform) => {\r\n    const urlKey = `Social${platform}Url`;\r\n    const iconKey = `Social${platform}Icon`;\r\n\r\n    extensionData.registerSetting({\r\n      setting: `${extensionId}.${urlKey}`,\r\n      type: 'url',\r\n      label: app.translator.trans(`wusong8899-client1.admin.${urlKey}`),\r\n      help: app.translator.trans(`wusong8899-client1.admin.${urlKey}Help`),\r\n    });\r\n\r\n    extensionData.registerSetting({\r\n      setting: `${extensionId}.${iconKey}`,\r\n      type: 'url',\r\n      label: app.translator.trans(`wusong8899-client1.admin.${iconKey}`),\r\n      help: app.translator.trans('wusong8899-client1.admin.SocialIconHelp'),\r\n    });\r\n  });\r\n\r\n  // Dynamic slide settings component\r\n  const maxSlides = getMaxSlides(extensionId);\r\n  extensionData.registerSetting(() => {\r\n    return m(DynamicSlideSettingsComponent, {\r\n      extensionId,\r\n      maxSlides\r\n    });\r\n  });\r\n});\r\n"],"names":["DynamicSlideSettingsComponent","Component","vnode","extensionId","maxSlides","slides","i","linkKey","imageKey","link","app","image","newSlide","m","slideId","slideIndex","slide","field","value","s","settingKey","key","timeoutKey","index","Button","e","target","defaultConfig","SOCIAL_PLATFORMS","getMaxSlides","backendMaxSlides","extensionData","platform","urlKey","iconKey"],"mappings":"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"}
{"version":3,"file":"admin.js","sources":["../src/admin/components/HeaderIconSettingComponent.tsx","../src/admin/SettingsGenerator.js","../src/admin/index.js"],"sourcesContent":["import app from 'flarum/admin/app';\nimport Component from 'flarum/common/Component';\nimport Button from 'flarum/common/components/Button';\nimport LoadingIndicator from 'flarum/common/components/LoadingIndicator';\nimport Stream from 'flarum/common/utils/Stream';\n\ninterface HeaderIconSettingComponentAttrs {\n  setting: string;\n  label: string;\n  help?: string;\n}\n\n/**\n * Custom component for header icon URL setting with preview and file upload support\n */\nexport default class HeaderIconSettingComponent extends Component<HeaderIconSettingComponentAttrs> {\n  private urlValue!: Stream<string>;\n  private loading = false;\n  private previewError = false;\n\n  oninit(vnode: any) {\n    super.oninit(vnode);\n    \n    const settingValue = app.data.settings[this.attrs.setting] || '';\n    this.urlValue = Stream(settingValue);\n  }\n\n  view() {\n    const { label, help } = this.attrs;\n    const currentUrl = this.urlValue();\n\n    return m('div.Form-group', [\n      m('label.FormLabel', label),\n      help && m('div.helpText', help),\n\n      m('div.HeaderIconSetting', [\n        // URL Input\n        m('div.HeaderIconSetting-input', [\n          m('input.FormControl', {\n            type: 'url',\n            placeholder: 'https://example.com/icon.png',\n            value: currentUrl,\n            oninput: (e: Event) => {\n              const target = e.target as HTMLInputElement;\n              this.urlValue(target.value);\n              this.previewError = false;\n              this.saveValue(target.value);\n            }\n          })\n        ]),\n\n        // Preview\n        currentUrl && m('div.HeaderIconSetting-preview', [\n          m('div.HeaderIconSetting-previewLabel',\n            app.translator.trans('wusong8899-client1.admin.HeaderIconPreview')\n          ),\n          m('div.HeaderIconSetting-previewContainer', [\n            this.loading ?\n              m(LoadingIndicator, { size: 'small' }) :\n            this.previewError ?\n              m('div.HeaderIconSetting-previewError',\n                app.translator.trans('wusong8899-client1.admin.HeaderIconPreviewError')\n              ) :\n              m('img.HeaderIconSetting-previewImage', {\n                src: currentUrl,\n                alt: 'Header Icon Preview',\n                onload: () => {\n                  this.previewError = false;\n                  m.redraw();\n                },\n                onerror: () => {\n                  this.previewError = true;\n                  m.redraw();\n                }\n              })\n          ])\n        ]),\n\n        // File Upload Section (Future Enhancement)\n        m('div.HeaderIconSetting-upload', [\n          m('div.HeaderIconSetting-uploadLabel',\n            app.translator.trans('wusong8899-client1.admin.HeaderIconUploadLabel')\n          ),\n          m(Button, {\n            className: 'Button Button--primary',\n            disabled: true,\n            onclick: () => {\n              // TODO: Implement file upload functionality\n              app.alerts.show({\n                type: 'info',\n                content: app.translator.trans('wusong8899-client1.admin.HeaderIconUploadComingSoon')\n              });\n            }\n          }, app.translator.trans('wusong8899-client1.admin.HeaderIconUploadButton')),\n          m('div.HeaderIconSetting-uploadHelp',\n            app.translator.trans('wusong8899-client1.admin.HeaderIconUploadHelp')\n          )\n        ])\n      ])\n    ]);\n  }\n\n  /**\n   * Save the setting value\n   */\n  private saveValue(value: string) {\n    // Debounce the save operation\n    clearTimeout((this as any).saveTimeout);\n    (this as any).saveTimeout = setTimeout(() => {\n      app.data.settings[this.attrs.setting] = value;\n      \n      // Save to backend\n      app.request({\n        method: 'POST',\n        url: app.forum.attribute('apiUrl') + '/settings',\n        body: {\n          [this.attrs.setting]: value\n        }\n      }).catch(() => {\n        // Handle save error silently for now\n      });\n    }, 500);\n  }\n}\n","import app from 'flarum/admin/app';\nimport HeaderIconSettingComponent from './components/HeaderIconSettingComponent';\n\n/**\n * Settings generator utility for admin interface\n */\nexport class SettingsGenerator {\n    constructor(extensionId) {\n        this.extensionId = extensionId;\n        this.extensionData = app.extensionData.for(extensionId);\n    }\n\n    /**\n     * Register transition time setting\n     */\n    registerTransitionTimeSetting() {\n        this.extensionData.registerSetting({\n            setting: `${this.extensionId}.TransitionTime`,\n            type: 'number',\n            label: app.translator.trans('wusong8899-client1.admin.TransitionTime'),\n        });\n        return this;\n    }\n\n    /**\n     * Register header icon URL setting\n     */\n    registerHeaderIconUrlSetting() {\n        this.extensionData.registerSetting(() => {\n            return m(HeaderIconSettingComponent, {\n                setting: `${this.extensionId}.HeaderIconUrl`,\n                label: app.translator.trans('wusong8899-client1.admin.HeaderIconUrl'),\n                help: app.translator.trans('wusong8899-client1.admin.HeaderIconUrlHelp'),\n            });\n        });\n        return this;\n    }\n\n    /**\n     * Register settings for advertisement slides\n     * @param {number} maxSlides - Maximum number of slides to configure\n     */\n    registerSlideSettings(maxSlides = 30) {\n        for (let i = 1; i <= maxSlides; i++) {\n            // Register link setting\n            this.extensionData.registerSetting({\n                setting: `${this.extensionId}.Link${i}`,\n                type: 'URL',\n                label: app.translator.trans(`wusong8899-client1.admin.Link${i}`),\n            });\n\n            // Register image setting\n            this.extensionData.registerSetting({\n                setting: `${this.extensionId}.Image${i}`,\n                type: 'URL',\n                label: app.translator.trans(`wusong8899-client1.admin.Image${i}`),\n            });\n        }\n        return this;\n    }\n\n    /**\n     * Register all settings for the extension\n     * @param {number} maxSlides - Maximum number of slides to configure\n     */\n    registerAllSettings(maxSlides = 30) {\n        return this\n            .registerTransitionTimeSetting()\n            .registerHeaderIconUrlSetting()\n            .registerSlideSettings(maxSlides);\n    }\n}\n\n/**\n * Configuration constants\n */\n// Centralized config is in js/src/common/config.\n// Kept for backward compatibility; prefer importing from '../../common/config'.\nexport const EXTENSION_CONFIG = {\n    EXTENSION_ID: 'wusong8899-client1-header-adv',\n    MAX_SLIDES: 30,\n    DEFAULT_TRANSITION_TIME: 5000,\n};\n\n/**\n * Initialize admin settings\n * @param {string} extensionId - The extension identifier\n * @param {number} maxSlides - Maximum number of slides\n */\nexport function initializeAdminSettings(\n    extensionId = EXTENSION_CONFIG.EXTENSION_ID, \n    maxSlides = EXTENSION_CONFIG.MAX_SLIDES\n) {\n    const generator = new SettingsGenerator(extensionId);\n    generator.registerAllSettings(maxSlides);\n}\n","import app from 'flarum/admin/app';\r\nimport { initializeAdminSettings } from './SettingsGenerator';\r\n\r\napp.initializers.add('wusong8899/client1-header-adv', () => {\r\n    initializeAdminSettings();\r\n});\r\n"],"names":["HeaderIconSettingComponent","Component","vnode","settingValue","app","Stream","label","help","currentUrl","e","target","LoadingIndicator","Button","value","SettingsGenerator","extensionId","maxSlides","i","EXTENSION_CONFIG","initializeAdminSettings"],"mappings":"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"}
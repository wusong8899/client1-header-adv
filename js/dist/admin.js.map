{"version":3,"file":"admin.js","sources":["../src/admin/index.tsx"],"sourcesContent":["import app from 'flarum/admin/app';\r\nimport Component from 'flarum/common/Component';\r\n\r\n/**\r\n * Extension configuration constants\r\n */\r\nconst EXTENSION_ID = 'wusong8899-client1-header-adv';\r\nconst SOCIAL_PLATFORMS = ['Kick', 'Facebook', 'Twitter', 'YouTube', 'Instagram'] as const;\r\nconst DEFAULT_MAX_SLIDES = 30;\r\n\r\n/**\r\n * Simplified slide data structure\r\n */\r\ninterface SlideData {\r\n  id: string;\r\n  image: string;\r\n  link: string;\r\n  active: boolean;\r\n  order: number;\r\n}\r\n\r\n/**\r\n * Social media link structure\r\n */\r\ninterface SocialLink {\r\n  platform: string;\r\n  url: string;\r\n  icon: string;\r\n}\r\n\r\n/**\r\n * Extension settings structure\r\n */\r\ninterface ExtensionSettings {\r\n  slides: SlideData[];\r\n  transitionTime: number;\r\n  socialLinks: SocialLink[];\r\n}\r\n\r\n/**\r\n * Unified Admin Management Component\r\n * Consolidates slideshow management, social media settings, and global configuration\r\n */\r\nclass UnifiedAdminComponent extends Component {\r\n  private settings: ExtensionSettings = {\r\n    slides: [],\r\n    transitionTime: 5000,\r\n    socialLinks: []\r\n  };\r\n\r\n  oninit() {\r\n    this.loadSettings();\r\n  }\r\n\r\n  /**\r\n   * Load all settings from Flarum\r\n   */\r\n  loadSettings(): void {\r\n    try {\r\n      const settingsJson = app.data.settings[`${EXTENSION_ID}.settings`];\r\n      if (settingsJson) {\r\n        this.settings = JSON.parse(settingsJson);\r\n      } else {\r\n        // Load from legacy format if JSON doesn't exist\r\n        this.loadLegacySettings();\r\n      }\r\n    } catch (error) {\r\n      console.error('Failed to load settings:', error);\r\n      this.loadLegacySettings();\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Load settings from legacy individual keys\r\n   */\r\n  loadLegacySettings(): void {\r\n    const slides: SlideData[] = [];\r\n    const socialLinks: SocialLink[] = [];\r\n\r\n    // Load slides from legacy format\r\n    for (let i = 1; i <= DEFAULT_MAX_SLIDES; i++) {\r\n      const link = app.data.settings[`${EXTENSION_ID}.Link${i}`] || '';\r\n      const image = app.data.settings[`${EXTENSION_ID}.Image${i}`] || '';\r\n      \r\n      if (link || image) {\r\n        slides.push({\r\n          id: `slide-${i}`,\r\n          image,\r\n          link,\r\n          active: true,\r\n          order: i\r\n        });\r\n      }\r\n    }\r\n\r\n    // Load social media links from legacy format\r\n    SOCIAL_PLATFORMS.forEach((platform) => {\r\n      const url = app.data.settings[`${EXTENSION_ID}.Social${platform}Url`] || '';\r\n      const icon = app.data.settings[`${EXTENSION_ID}.Social${platform}Icon`] || '';\r\n      \r\n      socialLinks.push({\r\n        platform,\r\n        url,\r\n        icon\r\n      });\r\n    });\r\n\r\n    this.settings = {\r\n      slides,\r\n      transitionTime: parseInt(app.data.settings[`${EXTENSION_ID}.TransitionTime`]) || 5000,\r\n      socialLinks\r\n    };\r\n  }\r\n\r\n  /**\r\n   * Save all settings to Flarum\r\n   */\r\n  async saveSettings(): Promise<void> {\r\n    try {\r\n      const settingsJson = JSON.stringify(this.settings);\r\n      \r\n      app.data.settings[`${EXTENSION_ID}.settings`] = settingsJson;\r\n      \r\n      await app.request({\r\n        method: 'POST',\r\n        url: `${app.forum.attribute('apiUrl')}/settings`,\r\n        body: { [`${EXTENSION_ID}.settings`]: settingsJson }\r\n      });\r\n      \r\n      app.alerts.show({ type: 'success' }, app.translator.trans('core.admin.saved_message'));\r\n    } catch (error) {\r\n      console.error('Failed to save settings:', error);\r\n      app.alerts.show({ type: 'error' }, 'Failed to save settings');\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Add new slide\r\n   */\r\n  addSlide(): void {\r\n    const newSlide: SlideData = {\r\n      id: `slide-${Date.now()}`,\r\n      image: '',\r\n      link: '',\r\n      active: true,\r\n      order: this.settings.slides.length + 1\r\n    };\r\n    \r\n    this.settings.slides.push(newSlide);\r\n    m.redraw();\r\n  }\r\n\r\n  /**\r\n   * Delete slide\r\n   */\r\n  deleteSlide(slideId: string): void {\r\n    this.settings.slides = this.settings.slides.filter(slide => slide.id !== slideId);\r\n    // Reorder remaining slides\r\n    this.settings.slides.forEach((slide, index) => {\r\n      slide.order = index + 1;\r\n    });\r\n    m.redraw();\r\n  }\r\n\r\n  /**\r\n   * Update slide\r\n   */\r\n  updateSlide(slideId: string, field: keyof SlideData, value: any): void {\r\n    const slide = this.settings.slides.find(s => s.id === slideId);\r\n    if (slide) {\r\n      (slide as any)[field] = value;\r\n      m.redraw();\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Update social media link\r\n   */\r\n  updateSocialLink(platform: string, field: 'url' | 'icon', value: string): void {\r\n    const socialLink = this.settings.socialLinks.find(s => s.platform === platform);\r\n    if (socialLink) {\r\n      socialLink[field] = value;\r\n      m.redraw();\r\n    }\r\n  }\r\n\r\n  view() {\r\n    return (\r\n      <div className=\"UnifiedAdminComponent\">\r\n        <div className=\"Form-group\">\r\n          <h3>{app.translator.trans('wusong8899-client1.admin.GlobalSettings')}</h3>\r\n          \r\n          <label className=\"FormLabel\">\r\n            {app.translator.trans('wusong8899-client1.admin.TransitionTime')}\r\n          </label>\r\n          <input\r\n            className=\"FormControl\"\r\n            type=\"number\"\r\n            min=\"1000\"\r\n            max=\"30000\"\r\n            value={this.settings.transitionTime}\r\n            oninput={(e: Event) => {\r\n              this.settings.transitionTime = parseInt((e.target as HTMLInputElement).value);\r\n            }}\r\n          />\r\n        </div>\r\n\r\n        <div className=\"Form-group\">\r\n          <h3>{app.translator.trans('wusong8899-client1.admin.SlidesManagement')}</h3>\r\n          \r\n          {this.settings.slides.map((slide) => this.renderSlide(slide))}\r\n          \r\n          <button className=\"Button Button--primary\" onclick={() => this.addSlide()}>\r\n            {app.translator.trans('wusong8899-client1.admin.AddSlide')}\r\n          </button>\r\n        </div>\r\n\r\n        <div className=\"Form-group\">\r\n          <h3>{app.translator.trans('wusong8899-client1.admin.SocialMediaTitle')}</h3>\r\n          \r\n          {SOCIAL_PLATFORMS.map((platform) => this.renderSocialPlatform(platform))}\r\n        </div>\r\n\r\n        <div className=\"Form-group\">\r\n          <button className=\"Button Button--primary\" onclick={() => this.saveSettings()}>\r\n            {app.translator.trans('core.admin.save_changes')}\r\n          </button>\r\n        </div>\r\n      </div>\r\n    );\r\n  }\r\n\r\n  /**\r\n   * Render slide configuration\r\n   */\r\n  renderSlide(slide: SlideData) {\r\n    return (\r\n      <div className=\"SlideConfig\" key={slide.id}>\r\n        <div className=\"SlideConfig-header\">\r\n          <h4>Slide {slide.order}</h4>\r\n          <input\r\n            type=\"checkbox\"\r\n            checked={slide.active}\r\n            onchange={(e: Event) => {\r\n              this.updateSlide(slide.id, 'active', (e.target as HTMLInputElement).checked);\r\n            }}\r\n          />\r\n          <button \r\n            className=\"Button Button--danger\" \r\n            onclick={() => this.deleteSlide(slide.id)}\r\n          >\r\n            {app.translator.trans('core.admin.delete')}\r\n          </button>\r\n        </div>\r\n        \r\n        <div className=\"Form-group\">\r\n          <label className=\"FormLabel\">Image URL</label>\r\n          <input\r\n            className=\"FormControl\"\r\n            type=\"url\"\r\n            value={slide.image}\r\n            oninput={(e: Event) => {\r\n              this.updateSlide(slide.id, 'image', (e.target as HTMLInputElement).value);\r\n            }}\r\n          />\r\n        </div>\r\n        \r\n        <div className=\"Form-group\">\r\n          <label className=\"FormLabel\">Link URL</label>\r\n          <input\r\n            className=\"FormControl\"\r\n            type=\"url\"\r\n            value={slide.link}\r\n            oninput={(e: Event) => {\r\n              this.updateSlide(slide.id, 'link', (e.target as HTMLInputElement).value);\r\n            }}\r\n          />\r\n        </div>\r\n      </div>\r\n    );\r\n  }\r\n\r\n  /**\r\n   * Render social platform configuration\r\n   */\r\n  renderSocialPlatform(platform: string) {\r\n    const socialLink = this.settings.socialLinks.find(s => s.platform === platform) || \r\n                      { platform, url: '', icon: '' };\r\n\r\n    return (\r\n      <div className=\"SocialPlatformConfig\" key={platform}>\r\n        <h4>{platform}</h4>\r\n        \r\n        <div className=\"Form-group\">\r\n          <label className=\"FormLabel\">URL</label>\r\n          <input\r\n            className=\"FormControl\"\r\n            type=\"url\"\r\n            placeholder={`https://${platform.toLowerCase()}.com/yourprofile`}\r\n            value={socialLink.url}\r\n            oninput={(e: Event) => {\r\n              this.updateSocialLink(platform, 'url', (e.target as HTMLInputElement).value);\r\n            }}\r\n          />\r\n        </div>\r\n        \r\n        <div className=\"Form-group\">\r\n          <label className=\"FormLabel\">Icon URL</label>\r\n          <input\r\n            className=\"FormControl\"\r\n            type=\"url\"\r\n            placeholder=\"https://example.com/icon.png\"\r\n            value={socialLink.icon}\r\n            oninput={(e: Event) => {\r\n              this.updateSocialLink(platform, 'icon', (e.target as HTMLInputElement).value);\r\n            }}\r\n          />\r\n          \r\n          {socialLink.icon && (\r\n            <div className=\"IconPreview\">\r\n              <img src={socialLink.icon} alt={`${platform} icon`} style=\"max-width: 32px; max-height: 32px;\" />\r\n            </div>\r\n          )}\r\n        </div>\r\n      </div>\r\n    );\r\n  }\r\n}\r\n\r\n/**\r\n * Initialize the unified admin interface\r\n */\r\napp.initializers.add(EXTENSION_ID, (): void => {\r\n  const extensionData = app.extensionData.for(EXTENSION_ID);\r\n\r\n  // Register the unified admin component\r\n  extensionData.registerSetting(() => m(UnifiedAdminComponent));\r\n});"],"names":["EXTENSION_ID","SOCIAL_PLATFORMS","UnifiedAdminComponent","Component","settingsJson","app","error","slides","socialLinks","i","link","image","platform","url","icon","newSlide","slideId","slide","index","field","value","s","socialLink","e"],"mappings":"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"}
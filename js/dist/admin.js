(function(i,g,r){"use strict";const s="wusong8899-client1-header-adv",c=["Kick","Facebook","Twitter","YouTube","Instagram"];class u extends g{oninit(t){super.oninit(t),this.setting(`${s}.settings`)()||this.migrateFromLegacy(),this.getSettings().slides.length===0&&this.addDefaultSlides(),this.initializeStreams()}getSettings(){try{const t=this.setting(`${s}.settings`)()||"{}",e=JSON.parse(t);return{slides:e.slides||[],transitionTime:e.transitionTime||5e3,socialLinks:e.socialLinks||[],headerIcon:e.headerIcon||{url:i.data.settings[`${s}.headerIconUrl`]||"",link:i.data.settings[`${s}.headerIconLink`]||""},tagGlideTitle:e.tagGlideTitle||""}}catch(t){return console.error("Failed to parse settings JSON:",t),{slides:[],transitionTime:5e3,socialLinks:[],headerIcon:{url:i.data.settings[`${s}.headerIconUrl`]||"",link:i.data.settings[`${s}.headerIconLink`]||""},tagGlideTitle:""}}}initializeStreams(){const t=this.getSettings();this.transitionTimeStream=r(t.transitionTime),this.tagGlideTitleStream=r(t.tagGlideTitle||""),this.headerIconUrlStream=r(t.headerIcon?.url||""),this.headerIconLinkStream=r(t.headerIcon?.link||""),this.transitionTimeStream.map(e=>{const n=this.getSettings();n.transitionTime=e,this.updateSettings(n)}),this.tagGlideTitleStream.map(e=>{const n=this.getSettings();n.tagGlideTitle=e,this.updateSettings(n)}),this.headerIconUrlStream.map(e=>{this.updateHeaderIcon("url",e)}),this.headerIconLinkStream.map(e=>{this.updateHeaderIcon("link",e)})}updateSettings(t){try{const e=JSON.stringify(t);this.setting(`${s}.settings`)(e),this.setting(`${s}.TransitionTime`)(t.transitionTime.toString()),t.headerIcon&&(this.setting(`${s}.headerIconUrl`)(t.headerIcon.url||""),this.setting(`${s}.headerIconLink`)(t.headerIcon.link||""))}catch(e){console.error("Failed to save settings:",e)}}migrateFromLegacy(){const t={slides:[],transitionTime:parseInt(i.data.settings[`${s}.TransitionTime`])||5e3,socialLinks:[],headerIcon:{url:i.data.settings[`${s}.headerIconUrl`]||"",link:i.data.settings[`${s}.headerIconLink`]||""}};for(let e=1;e<=30;e++){const n=i.data.settings[`${s}.Image${e}`],a=i.data.settings[`${s}.Link${e}`];(n||a)&&t.slides.push({id:`legacy-${e}`,image:n||"",link:a||"",active:!0,order:e})}c.forEach(e=>{const n=i.data.settings[`${s}.Social${e}Url`],a=i.data.settings[`${s}.Social${e}Icon`];(n||a)&&t.socialLinks.push({platform:e,url:n||"",icon:a||""})}),this.updateSettings(t)}addDefaultSlides(){const t=this.getSettings();t.slides=[{id:"slide-default-1",image:"https://via.placeholder.com/800x400/FF6B6B/FFFFFF?text=Advertisement+1",link:"https://example.com/ad1",active:!0,order:1},{id:"slide-default-2",image:"https://via.placeholder.com/800x400/4ECDC4/FFFFFF?text=Advertisement+2",link:"https://example.com/ad2",active:!0,order:2}],this.updateSettings(t)}addSlide(){const t=this.getSettings(),e={id:`slide-${Date.now()}`,image:"",link:"",active:!0,order:t.slides.length+1};t.slides.push(e),this.updateSettings(t)}deleteSlide(t){const e=this.getSettings();e.slides=e.slides.filter(n=>n.id!==t),e.slides.forEach((n,a)=>{n.order=a+1}),this.updateSettings(e)}updateSlide(t,e,n){const a=this.getSettings(),l=a.slides.find(d=>d.id===t);l&&(l[e]=n,this.updateSettings(a))}updateSocialLink(t,e,n){const a=this.getSettings();let l=a.socialLinks.find(d=>d.platform===t);l||(l={platform:t,url:"",icon:""},a.socialLinks.push(l)),l[e]=n,this.updateSettings(a)}updateHeaderIcon(t,e){const n=this.getSettings();n.headerIcon||(n.headerIcon={url:"",link:""}),n.headerIcon[t]=e,this.updateSettings(n)}content(){const t=this.getSettings();return m("div",{className:"ExtensionPage-settings"},m("div",{className:"container"},m("div",{className:"UnifiedAdminComponent"},m("div",{className:"Form-group"},m("h3",null,i.translator.trans("wusong8899-client1.admin.GlobalSettings")),m("label",{className:"FormLabel"},i.translator.trans("wusong8899-client1.admin.TransitionTime")),m("input",{className:"FormControl",type:"number",min:"1000",max:"30000",bidi:this.transitionTimeStream})),m("div",{className:"Form-group"},m("h3",null,i.translator.trans("wusong8899-client1.admin.TagGlideTitle")),m("label",{className:"FormLabel"},i.translator.trans("wusong8899-client1.admin.TagGlideTitleLabel")),m("input",{className:"FormControl",type:"text",placeholder:i.translator.trans("wusong8899-client1.admin.TagGlideTitlePlaceholder"),bidi:this.tagGlideTitleStream}),m("div",{className:"helpText"},i.translator.trans("wusong8899-client1.admin.TagGlideTitleHelp"))),m("div",{className:"Form-group"},m("h3",null,i.translator.trans("wusong8899-client1.admin.HeaderIconTitle")),m("label",{className:"FormLabel"},i.translator.trans("wusong8899-client1.admin.HeaderIconUrl")),m("input",{className:"FormControl",type:"url",placeholder:i.translator.trans("wusong8899-client1.admin.HeaderIconUrlHelp"),bidi:this.headerIconUrlStream}),m("label",{className:"FormLabel"},i.translator.trans("wusong8899-client1.admin.HeaderIconLink")),m("input",{className:"FormControl",type:"url",placeholder:i.translator.trans("wusong8899-client1.admin.HeaderIconLinkHelp"),bidi:this.headerIconLinkStream})),m("div",{className:"Form-group"},m("h3",null,i.translator.trans("wusong8899-client1.admin.SlidesManagement")),t.slides.map(e=>this.renderSlide(e)),m("button",{className:"Button Button--primary",onclick:()=>this.addSlide()},i.translator.trans("wusong8899-client1.admin.AddSlide"))),m("div",{className:"Form-group"},m("h3",null,i.translator.trans("wusong8899-client1.admin.SocialMediaTitle")),c.map(e=>this.renderSocialPlatform(e))),m("div",{className:"Form-group"},this.submitButton()))))}renderSlide(t){return m("div",{className:"SlideConfig",key:t.id},m("div",{className:"SlideConfig-header"},m("h4",null,"Slide ",t.order),m("input",{type:"checkbox",checked:t.active,onchange:e=>{this.updateSlide(t.id,"active",e.target.checked)}}),m("button",{className:"Button Button--danger",onclick:()=>this.deleteSlide(t.id)},i.translator.trans("wusong8899-client1.admin.DeleteButton"))),m("div",{className:"Form-group"},m("label",{className:"FormLabel"},i.translator.trans("wusong8899-client1.admin.SlideImageLabel")),m("input",{className:"FormControl",type:"url",value:t.image,oninput:e=>{this.updateSlide(t.id,"image",e.target.value)}})),m("div",{className:"Form-group"},m("label",{className:"FormLabel"},i.translator.trans("wusong8899-client1.admin.SlideLinkLabel")),m("input",{className:"FormControl",type:"url",value:t.link,oninput:e=>{this.updateSlide(t.id,"link",e.target.value)}})))}renderSocialPlatform(t){const n=this.getSettings().socialLinks.find(a=>a.platform===t)||{url:"",icon:""};return m("div",{className:"SocialPlatformConfig",key:t},m("h4",null,t),m("div",{className:"Form-group"},m("label",{className:"FormLabel"},"URL"),m("input",{className:"FormControl",type:"url",placeholder:`https://${t.toLowerCase()}.com/yourprofile`,value:n.url,oninput:a=>{this.updateSocialLink(t,"url",a.target.value)}})),m("div",{className:"Form-group"},m("label",{className:"FormLabel"},"Icon URL"),m("input",{className:"FormControl",type:"url",placeholder:"https://example.com/icon.png",value:n.icon,oninput:a=>{this.updateSocialLink(t,"icon",a.target.value)}}),n.icon&&m("div",{className:"IconPreview"},m("img",{src:n.icon,alt:`${t} icon`,style:"max-width: 32px; max-height: 32px;"}))))}}i.initializers.add(s,()=>{const o=i.extensionData.for(s);o.registerSetting({setting:`${s}.settings`,type:"text",label:"",hidden:!0}),o.registerSetting({setting:`${s}.TransitionTime`,type:"number",label:"",hidden:!0}),o.registerPage(u)})})(flarum.core.compat["admin/app"],flarum.core.compat["admin/components/ExtensionPage"],flarum.core.compat["common/utils/Stream"]);
//# sourceMappingURL=admin.js.map

module.exports={};
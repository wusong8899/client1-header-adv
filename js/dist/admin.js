(function(n,d,l){"use strict";const s="wusong8899-client1-header-adv";class c extends d{oninit(e){super.oninit(e),this.setting(`${s}.settings`)()||this.setting(`${s}.settings`)("{}"),this.getSettings().slides.length===0&&this.addDefaultSlides(),this.initializeStreams()}getSettings(){try{const e=this.setting(`${s}.settings`)()||"{}",t=JSON.parse(e);return{slides:t.slides||[],transitionTime:t.transitionTime||5e3,headerIcon:t.headerIcon||{url:"",link:""},tagGlideTitle:t.tagGlideTitle||"",tagGlideTitleIcon:t.tagGlideTitleIcon||"",titleActions:t.titleActions||[]}}catch(e){return console.error("Failed to parse settings JSON:",e),{slides:[],transitionTime:5e3,headerIcon:{url:"",link:""},tagGlideTitle:"",tagGlideTitleIcon:"",titleActions:[]}}}initializeStreams(){const e=this.getSettings();this.transitionTimeStream=l(e.transitionTime),this.tagGlideTitleStream=l(e.tagGlideTitle||""),this.tagGlideTitleIconStream=l(e.tagGlideTitleIcon||""),this.headerIconUrlStream=l(e.headerIcon?.url||""),this.headerIconLinkStream=l(e.headerIcon?.link||""),this.titleActionsStream=l(e.titleActions&&e.titleActions.length?e.titleActions:this.getDefaultTitleActions()),this.transitionTimeStream.map(t=>{const i=this.getSettings();i.transitionTime=t,this.updateSettings(i)}),this.tagGlideTitleStream.map(t=>{const i=this.getSettings();i.tagGlideTitle=t,this.updateSettings(i)}),this.tagGlideTitleIconStream.map(t=>{const i=this.getSettings();i.tagGlideTitleIcon=t,this.updateSettings(i)}),this.headerIconUrlStream.map(t=>{this.updateHeaderIcon("url",t)}),this.headerIconLinkStream.map(t=>{this.updateHeaderIcon("link",t)}),this.titleActionsStream.map(t=>{const i=this.getSettings();i.titleActions=t,this.updateSettings(i)})}updateSettings(e){try{const t=JSON.stringify(e);this.setting(`${s}.settings`)(t)}catch(t){console.error("Failed to save settings:",t)}}addDefaultSlides(){const e=this.getSettings();e.slides=[{id:"slide-default-1",image:"https://via.placeholder.com/800x400/FF6B6B/FFFFFF?text=Advertisement+1",link:"https://example.com/ad1",active:!0,order:1},{id:"slide-default-2",image:"https://via.placeholder.com/800x400/4ECDC4/FFFFFF?text=Advertisement+2",link:"https://example.com/ad2",active:!0,order:2}],this.updateSettings(e)}addSlide(){const e=this.getSettings(),t={id:`slide-${Date.now()}`,image:"",link:"",active:!0,order:e.slides.length+1};e.slides.push(t),this.updateSettings(e)}deleteSlide(e){const t=this.getSettings();t.slides=t.slides.filter(i=>i.id!==e),t.slides.forEach((i,a)=>{i.order=a+1}),this.updateSettings(t)}updateSlide(e,t,i){const a=this.getSettings(),o=a.slides.find(g=>g.id===e);o&&(o[t]=i,this.updateSettings(a))}updateHeaderIcon(e,t){const i=this.getSettings();i.headerIcon||(i.headerIcon={url:"",link:""}),i.headerIcon[e]=t,this.updateSettings(i)}getDefaultTitleActions(){return[{id:"live",label:"直播",imageUrl:"",linkUrl:"",enabled:!1},{id:"lottery",label:"彩票",imageUrl:"",linkUrl:"",enabled:!1},{id:"loan",label:"老哥贷",imageUrl:"",linkUrl:"",enabled:!1}]}updateTitleAction(e,t,i){const a=[...this.titleActionsStream()||[]];a[e]&&(a[e][t]=i,this.titleActionsStream(a))}content(){const e=this.getSettings();return m("div",{className:"ExtensionPage-settings"},m("div",{className:"container"},m("div",{className:"UnifiedAdminComponent"},m("div",{className:"Form-group"},m("h3",null,n.translator.trans("wusong8899-client1.admin.TitleActions")),(this.titleActionsStream()||[]).map((t,i)=>m("div",{className:"TitleActionConfig",key:t.id||i},m("div",{className:"Form-group"},m("label",{className:"FormLabel"},n.translator.trans("wusong8899-client1.admin.TitleActionEnabled")),m("input",{type:"checkbox",checked:t.enabled,onchange:a=>this.updateTitleAction(i,"enabled",a.target.checked)})),m("div",{className:"Form-group"},m("label",{className:"FormLabel"},n.translator.trans("wusong8899-client1.admin.TitleActionLabel")),m("input",{className:"FormControl",type:"text",value:t.label,oninput:a=>this.updateTitleAction(i,"label",a.target.value)})),m("div",{className:"Form-group"},m("label",{className:"FormLabel"},n.translator.trans("wusong8899-client1.admin.TitleActionImageUrl")),m("input",{className:"FormControl",type:"url",value:t.imageUrl,oninput:a=>this.updateTitleAction(i,"imageUrl",a.target.value)})),m("div",{className:"Form-group"},m("label",{className:"FormLabel"},n.translator.trans("wusong8899-client1.admin.TitleActionLinkUrl")),m("input",{className:"FormControl",type:"url",value:t.linkUrl,oninput:a=>this.updateTitleAction(i,"linkUrl",a.target.value)}))))),m("div",{className:"Form-group"},m("h3",null,n.translator.trans("wusong8899-client1.admin.GlobalSettings")),m("label",{className:"FormLabel"},n.translator.trans("wusong8899-client1.admin.TransitionTime")),m("input",{className:"FormControl",type:"number",min:"1000",max:"30000",bidi:this.transitionTimeStream})),m("div",{className:"Form-group"},m("h3",null,n.translator.trans("wusong8899-client1.admin.TagGlideTitle")),m("label",{className:"FormLabel"},n.translator.trans("wusong8899-client1.admin.TagGlideTitleLabel")),m("input",{className:"FormControl",type:"text",placeholder:n.translator.trans("wusong8899-client1.admin.TagGlideTitlePlaceholder"),bidi:this.tagGlideTitleStream}),m("div",{className:"helpText"},n.translator.trans("wusong8899-client1.admin.TagGlideTitleHelp")),m("label",{className:"FormLabel"},n.translator.trans("wusong8899-client1.admin.TagGlideTitleIconLabel")),m("input",{className:"FormControl",type:"url",placeholder:n.translator.trans("wusong8899-client1.admin.TagGlideTitleIconPlaceholder"),bidi:this.tagGlideTitleIconStream}),m("div",{className:"helpText"},n.translator.trans("wusong8899-client1.admin.TagGlideTitleIconHelp")),this.tagGlideTitleIconStream()&&m("div",{className:"IconPreview"},m("img",{src:this.tagGlideTitleIconStream(),alt:"Tag title icon preview",style:"max-width: 18px; max-height: 18px; margin-top: 5px;"}))),m("div",{className:"Form-group"},m("h3",null,n.translator.trans("wusong8899-client1.admin.HeaderIconTitle")),m("label",{className:"FormLabel"},n.translator.trans("wusong8899-client1.admin.HeaderIconUrl")),m("input",{className:"FormControl",type:"url",placeholder:n.translator.trans("wusong8899-client1.admin.HeaderIconUrlHelp"),bidi:this.headerIconUrlStream}),m("label",{className:"FormLabel"},n.translator.trans("wusong8899-client1.admin.HeaderIconLink")),m("input",{className:"FormControl",type:"url",placeholder:n.translator.trans("wusong8899-client1.admin.HeaderIconLinkHelp"),bidi:this.headerIconLinkStream})),m("div",{className:"Form-group"},m("h3",null,n.translator.trans("wusong8899-client1.admin.SlidesManagement")),e.slides.map(t=>this.renderSlide(t)),m("button",{className:"Button Button--primary",onclick:()=>this.addSlide()},n.translator.trans("wusong8899-client1.admin.AddSlide"))),m("div",{className:"Form-group"},this.submitButton()))))}renderSlide(e){return m("div",{className:"SlideConfig",key:e.id},m("div",{className:"SlideConfig-header"},m("h4",null,"Slide ",e.order),m("input",{type:"checkbox",checked:e.active,onchange:t=>{this.updateSlide(e.id,"active",t.target.checked)}}),m("button",{className:"Button Button--danger",onclick:()=>this.deleteSlide(e.id)},n.translator.trans("wusong8899-client1.admin.DeleteButton"))),m("div",{className:"Form-group"},m("label",{className:"FormLabel"},n.translator.trans("wusong8899-client1.admin.SlideImageLabel")),m("input",{className:"FormControl",type:"url",value:e.image,oninput:t=>{this.updateSlide(e.id,"image",t.target.value)}})),m("div",{className:"Form-group"},m("label",{className:"FormLabel"},n.translator.trans("wusong8899-client1.admin.SlideLinkLabel")),m("input",{className:"FormControl",type:"url",value:e.link,oninput:t=>{this.updateSlide(e.id,"link",t.target.value)}})))}}n.initializers.add(s,()=>{const r=n.extensionData.for(s);r.registerSetting({setting:`${s}.settings`,type:"text",label:"",hidden:!0}),r.registerPage(c)})})(flarum.core.compat["admin/app"],flarum.core.compat["admin/components/ExtensionPage"],flarum.core.compat["common/utils/Stream"]);
//# sourceMappingURL=admin.js.map

module.exports={};